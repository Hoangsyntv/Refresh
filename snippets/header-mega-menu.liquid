
{% comment %}
  Improved Mega Menu: Responsive, 6â€“9 columns, banner, accessibility, hover delay, lazy-load, divider, etc.
{% endcomment %}

<nav class="header__inline-menu">
  <ul class="list-menu list-menu--inline" role="list">
    {%- for link in section.settings.menu.links -%}
      <li>
        {%- if link.links != blank -%}
          <header-menu>
            <details id="Details-HeaderMenu-{{ forloop.index }}" class="mega-menu" data-hover-delay="150">
              <summary
                id="HeaderMenu-{{ link.handle }}"
                class="header__menu-item list-menu__item link focus-inset"
                tabindex="0"
                aria-haspopup="true"
                aria-expanded="false"
              >
                <span class="mega-menu__column-title{% if link.child_active %} header__active-menu-item{% endif %}"><strong>{{- link.title | escape -}}</strong></span>
                {{- 'icon-caret.svg' | inline_asset_content -}}
              </summary>
              <div
                id="MegaMenu-Content-{{ forloop.index }}"
                class="mega-menu__content color-{{ section.settings.menu_color_scheme }} gradient motion-reduce global-settings-popup"
                tabindex="-1"
                style="z-index:1000;"
              >
                <div class="mega-menu__columns-wrapper">
                  {% assign col_count = link.links.size %}
                  {% if col_count > 9 %}
                    {% assign col_count = 9 %}
                  {% endif %}
                  {% assign split = false %}
                  {% if col_count > 10 %}
                    {% assign split = true %}
                  {% endif %}
                  <ul
                    class="mega-menu__columns"
                    style="display:grid;grid-template-columns:repeat({{ col_count }},1fr);gap:24px;border-bottom:1px solid #eee;"
                    role="list"
                  >
                    {%- for childlink in link.links -%}
                      <li class="mega-menu__column" style="border-right:1px solid #eee;padding:0 12px;">
                        <div class="mega-menu__column-title"><strong>{{ childlink.title | escape }}</strong></div>
                        <ul class="mega-menu__column-list" style="margin:0;padding:0;list-style:none;">
                          {%- for grandchildlink in childlink.links -%}
                            <li style="line-height:1.7;">
                              <a
                                id="HeaderMenu-{{ link.handle }}-{{ childlink.handle }}-{{ grandchildlink.handle }}"
                                href="{{ grandchildlink.url }}"
                                class="mega-menu__link link"
                                style="font-weight:400;font-size:15px;letter-spacing:0.01em;"
                                {% if grandchildlink.current %} aria-current="page"{% endif %}
                              >
                                {{ grandchildlink.title | escape }}
                              </a>
                            </li>
                          {%- endfor -%}
                        </ul>
                      </li>
                      {%- if split and forloop.index == col_count/2 -%}
                        </ul><ul class="mega-menu__columns" style="display:grid;grid-template-columns:repeat({{ [col_count/2,9] | min }},1fr);gap:24px;border-bottom:1px solid #eee;">
                      {%- endif -%}
                    {%- endfor -%}
                  </ul>
                  {%- if section.settings.banner_image != blank -%}
                  <div class="mega-menu__banner" style="margin-top:24px;text-align:center;">
                    <img src="{{ section.settings.banner_image | image_url: width:1200, height:600, format: 'webp' }}"
                         alt="Banner Mega Menu"
                         loading="lazy"
                         style="max-width:100%;height:auto;border-radius:8px;object-fit:cover;" />
                  </div>
                  {%- endif -%}
                </div>
              </div>
            </details>
          </header-menu>
        {%- else -%}
          <a
            id="HeaderMenu-{{ link.handle }}"
            href="{{ link.url }}"
            class="header__menu-item list-menu__item link link--text focus-inset"
            {% if link.current %} aria-current="page"{% endif %}
          >
            <span class="mega-menu__column-title{% if link.current %} header__active-menu-item{% endif %}"><strong>{{- link.title | escape -}}</strong></span>
          </a>
        {%- endif -%}
      </li>
    {%- endfor -%}
  </ul>
</nav>
