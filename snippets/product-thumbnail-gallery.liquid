{% comment %}
  Product Thumbnail Gallery
  
  Displays product images with thumbnail navigation
  - Vertical thumbnails on desktop (left side)
  - Horizontal thumbnails on mobile (bottom)
  - Smooth transitions and active states
  - Keyboard navigation support
  
  Usage:
  {% render 'product-thumbnail-gallery', product: product, section_id: section.id %}
  
  Parameters:
  - product: {Object} Product Liquid object (required)
  - section_id: {String} Section ID for unique naming (required)
  - image_ratio: {String} Image aspect ratio - 'square', 'portrait', 'landscape' (optional, default: 'square')
  - enable_zoom: {Boolean} Enable image zoom on click (optional, default: false)
{% endcomment %}

{%- assign image_ratio = image_ratio | default: 'square' -%}
{%- assign enable_zoom_setting = enable_zoom | default: 'disabled' -%}
{%- assign enable_zoom = false -%}
{%- if enable_zoom_setting == 'click' or enable_zoom_setting == 'hover' -%}
  {%- assign enable_zoom = true -%}
{%- endif -%}

{%- if product.images.size > 0 -%}
  <div class="product-gallery" data-product-gallery data-section-id="{{ section_id }}">
    <!-- Thumbnail Navigation (bên trái) -->
    {%- if product.images.size > 1 -%}
      <div class="product-gallery__thumbnails" data-thumbnails>
        <div class="product-gallery__thumbnails-wrapper">
          {%- for image in product.images -%}
            <button
              type="button"
              class="product-gallery__thumbnail{% if forloop.first %} active{% endif %}"
              data-thumbnail
              data-image-index="{{ forloop.index0 }}"
              aria-label="{{ 'products.product.view_image' | t: number: forloop.index }}"
              {% if forloop.first %}aria-current="true"{% endif %}
            >
              <img
                src="{{ image | image_url: width: 75, height: 75, crop: 'center' }}"
                alt="{{ image.alt | escape }}"
                width="75"
                height="75"
                loading="{% if forloop.index <= 4 %}eager{% else %}lazy{% endif %}"
                class="product-gallery__thumbnail-image"
              >
              
              <!-- Active indicator -->
              <span class="product-gallery__thumbnail-indicator" aria-hidden="true"></span>
            </button>
          {%- endfor -%}
        </div>
        
        <!-- Navigation arrows for mobile -->
        {%- if product.images.size > 4 -%}
          <button 
            type="button" 
            class="product-gallery__nav-btn product-gallery__nav-btn--prev" 
            data-nav-prev
            aria-label="{{ 'general.accessibility.previous' | t }}"
          >
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
              <path d="M10 12L6 8L10 4" stroke="currentColor" stroke-width="2"/>
            </svg>
          </button>
          
          <button 
            type="button" 
            class="product-gallery__nav-btn product-gallery__nav-btn--next" 
            data-nav-next
            aria-label="{{ 'general.accessibility.next' | t }}"
          >
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
              <path d="M6 4L10 8L6 12" stroke="currentColor" stroke-width="2"/>
            </svg>
          </button>
        {%- endif -%}
      </div>
    {%- endif -%}
    
    <!-- Main Image Display (bên phải) -->
    <div class="product-gallery__main" data-main-image-container>
      <div class="product-gallery__main-inner">
        {%- for image in product.images -%}
          <div 
            class="product-gallery__main-image{% if forloop.first %} active{% endif %}" 
            data-main-image
            data-image-index="{{ forloop.index0 }}"
            {% unless forloop.first %}style="display: none;"{% endunless %}
          >
            <img
              src="{{ image | image_url: width: 900 }}"
              srcset="
                {{ image | image_url: width: 450 }} 450w,
                {{ image | image_url: width: 600 }} 600w,
                {{ image | image_url: width: 750 }} 750w,
                {{ image | image_url: width: 900 }} 900w,
                {{ image | image_url: width: 1200 }} 1200w
              "
              sizes="(min-width: 1024px) 900px, (min-width: 768px) 75vw, 90vw"
              alt="{{ image.alt | escape }}"
              width="900"
              height="{{ image.height | divided_by: image.width | times: 900 | round }}"
              loading="{% if forloop.first %}eager{% else %}lazy{% endif %}"
              class="product-gallery__image"
              data-zoom-image="{{ image | image_url: width: 1600 }}"
            >
            
            {%- if enable_zoom -%}
              <button 
                type="button" 
                class="product-gallery__zoom-btn"
                data-zoom-trigger
                aria-label="{{ 'products.product.zoom_image' | t }}"
              >
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                  <path d="M9 2C13.418 2 17 5.582 17 10C17 14.418 13.418 18 9 18C4.582 18 1 14.418 1 10C1 5.582 4.582 2 9 2Z" stroke="currentColor" stroke-width="2"/>
                  <path d="M15 15L19 19" stroke="currentColor" stroke-width="2"/>
                  <path d="M6 10H12M9 7V13" stroke="currentColor" stroke-width="1.5"/>
                </svg>
              </button>
            {%- endif -%}
          </div>
        {%- endfor -%}
      </div>
    </div>
  </div>

  <!-- Zoom Modal (if enabled) -->
  {%- if enable_zoom -%}
    <div class="product-gallery__zoom-modal" data-zoom-modal>
      <div class="product-gallery__zoom-backdrop" data-zoom-close></div>
      <div class="product-gallery__zoom-content">
        <button 
          type="button" 
          class="product-gallery__zoom-close"
          data-zoom-close
          aria-label="{{ 'general.accessibility.close' | t }}"
        >
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2"/>
          </svg>
        </button>
        <img 
          src="" 
          alt="" 
          class="product-gallery__zoom-image"
          data-zoom-image-display
        >
      </div>
    </div>
  {%- endif -%}

{%- else -%}
  <!-- No images fallback -->
  <div class="product-gallery product-gallery--no-images">
    <div class="product-gallery__main">
      <div class="product-gallery__placeholder">
        {{ 'product-1' | placeholder_svg_tag: 'product-gallery__placeholder-svg' }}
      </div>
    </div>
  </div>
{%- endif -%}